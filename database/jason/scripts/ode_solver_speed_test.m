%{
-----------------------------------------------------------
% Michelle's GPe-MSN network model:
MSN_itonic_offset    = inf;
MSN_MSN_iSYN_mask    = rand((100),(100)) < (0.5);
GPe_itonic_offset    = inf;
model = @(t,X) [(((-(1.2).*X(101:200).*(X(1:100)-(-80))))+((-((0.1).*(X(1:100)-(-67))))+(((-(80).*X(201:300).^4.*(X(1:100)-(-80))))+(((-(100).*X(401:500).*X(301:400).^3.*(X(1:100)-(50))))+((((1.19)*(t>(0) & t<MSN_itonic_offset)))+((((7).*randn((100),1).*sqrt((0.01))))+((-(((0.5).*(X(501:600)'*MSN_MSN_iSYN_mask)'.*(X(1:100)-(-80)))))+0)))))));(3.209*0.0001*(X(1:100)+30)./(1-exp(-(X(1:100)+30)/9))).*(1-X(101:200)) + 3.209*0.0001*(X(1:100)+30)./(1-exp((X(1:100)+30)/9)).*X(101:200);0.032*(X(1:100)+52)./(1-exp(-(X(1:100)+52)/5)).*(1-X(201:300))-0.5*exp(-(X(1:100)+57)/40).*X(201:300);0.32*(X(1:100)+54)./(1-exp(-(X(1:100)+54)/4)).*(1-X(301:400))-0.28*(X(1:100)+27)./(exp((X(1:100)+27)/5)-1).*X(301:400);0.128*exp(-(X(1:100)+50)/18).*(1-X(401:500))-4./(1+exp(-(X(1:100)+27)/5)).*X(401:500);-X(501:600)./(1) + ((1-X(501:600))/(0.25)).*(1+tanh(X(1:100)/10));((((2)*(t>(0) & t<GPe_itonic_offset)))+((((0).*randn((10),1).*sqrt((0.01))))+(((-(5).*(X(611:620).^4).*X(621:630).*(X(601:610)-(-100))))+(((-(80)*X(631:640).^3.*X(641:650).*X(651:660).*(X(601:610)-(50))))+(((-(1).*(X(661:670).^4).*X(671:680).*(X(601:610)-(-100))))+(((-(0.04).*X(681:690).^4.*(X(601:610)-(-100))))+(((-(0.2).*(X(691:700).^3).*X(701:710).*X(711:720).*(X(601:610)-(50))))+(((-(0.1).*(X(721:730) + X(731:740)).*(X(601:610)-(-42))))+(((-(4).*(X(741:750).^4.*X(751:760) + X(761:770).^4.*X(771:780)).*(X(601:610)-(-100))))+(((-(0)*(1.0 ./ (1.0 + exp(-(X(601:610)+57.0)/2.0))).^3.*X(781:790).*(X(601:610)-(120))))+(((-(0.2)*X(801:810).*(X(601:610)-(-100))))+(((-(0.03).*X(811:820).*(X(601:610)-(120))))+0))))))))))));((((1.0) ./ (1 + exp((-26.0 - X(601:610))/7.8)))) - X(611:620))./(0.1 + ((14.0 - 0.1) ./ (exp((-26.0-X(601:610))/13.0) + exp(-(-26.0-X(601:610))/12.0))));((0.6 + ((1.0 - 0.6) ./ (1 + exp(-(-20.0 - X(601:610))/10.0)))) - X(621:630))./(7.0 + ((33.0 - 7.0) ./ (exp((-X(601:610))/10.0) + exp(-(-X(601:610))/10.0))));((((1.0) ./ (1 + exp((-39 - X(601:610))/5.0))))-X(631:640))./(0.028);((((1.0) ./ (1 + exp(-(-48 - X(601:610))/2.8))))-X(641:650))./(0.25 + ((4.0 - 0.25) ./ (exp((-43-X(601:610))/10.0) + exp(-(-43-X(601:610))/5.0))));((0.15 + ((1.0 - 0.15) ./ (1 + exp(-(-40 - X(601:610))/5.4))))-X(651:660))./(10.0 + ((1000 - 10.0) ./ (exp((-40-X(601:610))/18.3) + exp(-(-40-X(601:610))/10.0))));((((1.0) ./ (1 + exp((-33.2 - X(601:610))/9.1))))-X(661:670))./(0.1 + ((30.0 - 0.1) ./ (exp((-33.2-X(601:610))/21.7) + exp(-(-33.2-X(601:610))/13.9))));((0.2 + ((1.0 - 0.2) ./ (1 + exp(-(-20.0 - X(601:610))/10.0))))-X(671:680))./(3400);((1.0 ./ (1.0+exp((-61.0-X(601:610))/19.5)))-X(681:690))./(6.7 + ( (100-6.7)./(exp((-61-X(601:610))/35) + exp(-(-61-X(601:610))/25))));((((1.0) ./ (1 + exp((-57.7 - X(601:610))/5.7))))-X(691:700))./(0.03 + ((0.146 - 0.03) ./ (exp((-42.6-X(601:610))/14.4) + exp(-(-42.6-X(601:610))/14.4))));((0.154 + ((1.0 - 0.154) ./ (1 + exp(-(-57.0 - X(601:610))/4.0))))-X(701:710))./(10.0 + ((17.0 - 10.0) ./ (exp((-34.0-X(601:610))/26.0) + exp(-(-34.0-X(601:610))/31.9))));((((1.0) ./ (1 + exp(-(-10.0 - X(601:610))/4.9))))-X(711:720))./(1.0 ./ ((((-.00000288 * X(601:610)) - 0.000049) ./ (1.0 - exp((X(601:610) + (0.000049/0.00000288))/4.63))) + (((0.00000694 * X(601:610)) + 0.000447) ./ (1.0 - exp(-(X(601:610) + (0.000447/0.00000694))/2.63)))));((1.0./(1.0 + exp(-(-76.4-X(601:610))/3.3)))-X(721:730))./(max(.01, 3625 ./ (exp((-76.4-X(601:610))/6.56) + exp(-(-76.4-X(601:610))/7.48))));((((1.0) ./ (1 + exp(-(-87.5 - X(601:610))/4.0))))-X(731:740))./((6300) ./ (exp((-87.5-X(601:610))/8.9) + exp(-(-87.5-X(601:610))/8.2)));((((1.0) ./ (1 + exp((-49.0 - X(601:610))/12.5))))-X(741:750))./(0.25 + ((7.0 - 0.25) ./ (exp((-49.0-X(601:610))/29.0) + exp(-(-49.0-X(601:610))/29.0))));((((1.0) ./ (1 + exp(-(-83.0 - X(601:610))/10.0))))-X(751:760))./(7.0 + ((21.0 - 7.0) ./ (exp((-83.0-X(601:610))/10.0) + exp(-(-83.0-X(601:610))/10.0))));((((1.0) ./ (1 + exp((-49.0 - X(601:610))/12.5))))-X(761:770))./(0.25 + ((7.0 - 0.25) ./ (exp((-49.0-X(601:610))/29.0) + exp(-(-49.0-X(601:610))/29.0))));((((1.0) ./ (1 + exp(-(-83.0 - X(601:610))/10.0))))-X(771:780))./(50.0 + ((121.0 - 50.0) ./ (exp((-83.0-X(601:610))/10.0) + exp(-(-83.0-X(601:610))/10.0))));((1.0 ./ (1.0 + exp((X(601:610)+70.0)/2.0)))-X(781:790))./(30);(-0.1/(2*96485.0*0.1)) .* (-(-(0.03).*X(811:820).*(X(601:610)-(120))) + -(-(0)*(1.0 ./ (1.0 + exp(-(X(601:610)+57.0)/2.0))).^3.*X(781:790).*(X(601:610)-(120)))) - ((0.0001*X(791:800)) ./ (X(791:800) + 0.0001));((((X(791:800)*1000).^4.6) ./ ((X(791:800)*1000).^4.6 + 0.35^4.6))-X(801:810))./(((X(791:800)*1000 < 5.0).*(7.7 - (X(791:800)*1000 .* ((7.7 - 1.1) / 14.4)))) + ((X(791:800)*1000 >= 5.0).*1.1));((((1.0) ./ (1 + exp((-20.0 - X(601:610))/7.0))))-X(811:820))./(0.2);];
IC = [0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          -60          -60          -60          -60          -60          -60          -60          -60          -60          -60          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001       0.0001          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1        0.005        0.005        0.005        0.005        0.005        0.005        0.005        0.005        0.005        0.005      0.00026      0.00026      0.00026      0.00026      0.00026      0.00026      0.00026      0.00026      0.00026      0.00026          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9          0.9];
labels = {'MSN\_V','MSN\_Im\_w','MSN\_Ik\_n','MSN\_Ina\_m','MSN\_Ina\_h','MSN\_MSN\_iSYN\_sSYNpre','GPe\_V','GPe\_GPeIk\_n','GPe\_GPeIk\_s','GPe\_GPeIna\_m','GPe\_GPeIna\_h','GPe\_GPeIna\_s','GPe\_GPeIks\_m','GPe\_GPeIks\_h','GPe\_GPeIm\_w','GPe\_GPeInap\_m','GPe\_GPeInap\_h','GPe\_GPeInap\_s','GPe\_GPeIh\_r','GPe\_GPeIh\_s','GPe\_GPeIa\_m','GPe\_GPeIa\_h','GPe\_GPeIa\_ms','GPe\_GPeIa\_hs','GPe\_GPeIt\_m','GPe\_GPeCa\_Ca','GPe\_GPeIsk\_m','GPe\_GPeIhva\_m'};
%-----------------------------------------------------------
%}

% My superficial PFC model
%-----------------------------------------------------------
% Auxiliary variables:
	Ed_E_iCOM_UB         = max((40),(40));
	Ed_E_iCOM_Xpre       = linspace(1,Ed_E_iCOM_UB,(40))'*ones(1,(40));
	Ed_E_iCOM_Xpost      = (linspace(1,Ed_E_iCOM_UB,(40))'*ones(1,(40)))';
	Ed_E_iCOM_mask       = abs(Ed_E_iCOM_Xpre-Ed_E_iCOM_Xpost)<=(0.5);
	I_E_iSYNgbar_Nmax    = max((10),(40));
	I_E_iSYNgbar_Xpre    = linspace(1,I_E_iSYNgbar_Nmax,(10))'*ones(1,(40));
	I_E_iSYNgbar_Xpost   = (linspace(1,I_E_iSYNgbar_Nmax,(40))'*ones(1,(10)))';
	I_E_iSYNgbar_fanout  = ((0.2)*I_E_iSYNgbar_Nmax)/2;
	I_E_iSYNgbar_kernel  = exp(-(I_E_iSYNgbar_Xpre-I_E_iSYNgbar_Xpost).^2/I_E_iSYNgbar_fanout^2);
	I_E_iSYNgbar_mask    = abs(I_E_iSYNgbar_Xpre-I_E_iSYNgbar_Xpost)<=I_E_iSYNgbar_fanout;
	I_E_iSYNgbar_gbar    = (0.5) / mean(sum(I_E_iSYNgbar_mask,1));
	Ed_item1_sigma       = ceil((0.25)*(40));
	Ed_item1_mask        = circshift([ones(1,Ed_item1_sigma) zeros(1,(40)-Ed_item1_sigma)]',ceil(Ed_item1_sigma/2)-(40)/2);
	Ed_item2_sigma       = ceil((0.25)*(40));
	Ed_item2_mask        = circshift([ones(1,Ed_item2_sigma) zeros(1,(40)-Ed_item2_sigma)]',ceil(Ed_item2_sigma/2));
	E_Ed_iCOM_UB         = max((40),(40));
	E_Ed_iCOM_Xpre       = linspace(1,E_Ed_iCOM_UB,(40))'*ones(1,(40));
	E_Ed_iCOM_Xpost      = (linspace(1,E_Ed_iCOM_UB,(40))'*ones(1,(40)))';
	E_Ed_iCOM_mask       = abs(E_Ed_iCOM_Xpre-E_Ed_iCOM_Xpost)<=(0.5);
	E_Ed_iNMDAgbar_alphar = 7.2E4;
	E_Ed_iNMDAgbar_Nmax  = max((40),(40));
	E_Ed_iNMDAgbar_Nmax  = max((40),(40));
	E_Ed_iNMDAgbar_Xpre  = linspace(1,E_Ed_iNMDAgbar_Nmax,(40))'*ones(1,(40));
	E_Ed_iNMDAgbar_Xpost = (linspace(1,E_Ed_iNMDAgbar_Nmax,(40))'*ones(1,(40)))';
	E_Ed_iNMDAgbar_fanout = ((0.3)*E_Ed_iNMDAgbar_Nmax)/2;
	E_Ed_iNMDAgbar_kernel = exp(-(E_Ed_iNMDAgbar_Xpre-E_Ed_iNMDAgbar_Xpost).^2/E_Ed_iNMDAgbar_fanout^2);
	E_Ed_iNMDAgbar_mask  = abs(E_Ed_iNMDAgbar_Xpre-E_Ed_iNMDAgbar_Xpost)<=E_Ed_iNMDAgbar_fanout;
	E_Ed_iNMDAgbar_gbar  = (5) / mean(sum(E_Ed_iNMDAgbar_mask,1));
	E_Ed_iSYNgbar_Nmax   = max((40),(40));
	E_Ed_iSYNgbar_Xpre   = linspace(1,E_Ed_iSYNgbar_Nmax,(40))'*ones(1,(40));
	E_Ed_iSYNgbar_Xpost  = (linspace(1,E_Ed_iSYNgbar_Nmax,(40))'*ones(1,(40)))';
	E_Ed_iSYNgbar_fanout = ((0.3)*E_Ed_iSYNgbar_Nmax)/2;
	E_Ed_iSYNgbar_kernel = exp(-(E_Ed_iSYNgbar_Xpre-E_Ed_iSYNgbar_Xpost).^2/E_Ed_iSYNgbar_fanout^2);
	E_Ed_iSYNgbar_mask   = abs(E_Ed_iSYNgbar_Xpre-E_Ed_iSYNgbar_Xpost)<=E_Ed_iSYNgbar_fanout;
	E_Ed_iSYNgbar_gbar   = (0.1) / mean(sum(E_Ed_iSYNgbar_mask,1));
	CB_Ed_iSYNgbar_Nmax  = max((10),(40));
	CB_Ed_iSYNgbar_Xpre  = linspace(1,CB_Ed_iSYNgbar_Nmax,(10))'*ones(1,(40));
	CB_Ed_iSYNgbar_Xpost = (linspace(1,CB_Ed_iSYNgbar_Nmax,(40))'*ones(1,(10)))';
	CB_Ed_iSYNgbar_fanout = ((0.05)*CB_Ed_iSYNgbar_Nmax)/2;
	CB_Ed_iSYNgbar_kernel = exp(-(CB_Ed_iSYNgbar_Xpre-CB_Ed_iSYNgbar_Xpost).^2/CB_Ed_iSYNgbar_fanout^2);
	CB_Ed_iSYNgbar_mask  = abs(CB_Ed_iSYNgbar_Xpre-CB_Ed_iSYNgbar_Xpost)<=CB_Ed_iSYNgbar_fanout;
	CB_Ed_iSYNgbar_gbar  = (0.135) / mean(sum(CB_Ed_iSYNgbar_mask,1));
	E_I_iSYNgbar_Nmax    = max((40),(10));
	E_I_iSYNgbar_Xpre    = linspace(1,E_I_iSYNgbar_Nmax,(40))'*ones(1,(10));
	E_I_iSYNgbar_Xpost   = (linspace(1,E_I_iSYNgbar_Nmax,(10))'*ones(1,(40)))';
	E_I_iSYNgbar_fanout  = ((1)*E_I_iSYNgbar_Nmax)/2;
	E_I_iSYNgbar_kernel  = exp(-(E_I_iSYNgbar_Xpre-E_I_iSYNgbar_Xpost).^2/E_I_iSYNgbar_fanout^2);
	E_I_iSYNgbar_mask    = abs(E_I_iSYNgbar_Xpre-E_I_iSYNgbar_Xpost)<=E_I_iSYNgbar_fanout;
	E_I_iSYNgbar_gbar    = (1.09) / mean(sum(E_I_iSYNgbar_mask,1));
	I_I_wbSYN_mask       = rand((10),(10))<=(1);
	CB_ifocal_sigma      = ceil((0.4)*(10));
	CB_ifocal_mask       = circshift([ones(1,CB_ifocal_sigma) zeros(1,(10)-CB_ifocal_sigma)]',0);
	E_CB_iSYNgbar_Nmax   = max((40),(10));
	E_CB_iSYNgbar_Xpre   = linspace(1,E_CB_iSYNgbar_Nmax,(40))'*ones(1,(10));
	E_CB_iSYNgbar_Xpost  = (linspace(1,E_CB_iSYNgbar_Nmax,(10))'*ones(1,(40)))';
	E_CB_iSYNgbar_fanout = ((0.025)*E_CB_iSYNgbar_Nmax)/2;
	E_CB_iSYNgbar_kernel = exp(-(E_CB_iSYNgbar_Xpre-E_CB_iSYNgbar_Xpost).^2/E_CB_iSYNgbar_fanout^2);
	E_CB_iSYNgbar_mask   = abs(E_CB_iSYNgbar_Xpre-E_CB_iSYNgbar_Xpost)<=E_CB_iSYNgbar_fanout;
	E_CB_iSYNgbar_gbar   = (0.4) / mean(sum(E_CB_iSYNgbar_mask,1));

% ODE Handle, ICs, integration, and plotting:
model = @(t,X) [(((-((0.54).*(X(1:40)-(-80))))+((-((80).*X(41:80).^3.*X(81:120).*(X(1:40)-(55))))+((-((36).*X(121:160).^4.*(X(1:40)-(-80))))+((-((8.48826)*(1./max(.001,(1+exp(-(X(1:40)+20)/9)))).^2.*(X(1:40)-(150))))+((((200).*randn((40),1).*sqrt((0.01))))+((-((0.6)*(1./(1+exp(-(X(1:40)+(55.7+(5)))/7.7))).^3.*X(161:200).*(X(1:40)-(55))))+((-((0.07).*X(241:280).^2.*(X(1:40)-(-20))))+((-((5).*sum(((X(1:40)*ones(1,size(X(1:40),1)))'-(X(291:330)*ones(1,size(X(291:330),1)))).*Ed_E_iCOM_mask,2)))+((-((I_E_iSYNgbar_gbar.*(X(281:290)'*(I_E_iSYNgbar_mask.*I_E_iSYNgbar_kernel))'.*(X(1:40)-(-80)))))+0))))))))))./(0.8);((2.5-.1*(X(1:40)+65))./(exp(2.5-.1*(X(1:40)+65))-1)).*(1-X(41:80))-(4*exp(-(X(1:40)+65)/18)).*X(41:80);(.07*exp(-(X(1:40)+65)/20)).*(1-X(81:120))-(1./(exp(3-.1*(X(1:40)+65))+1)).*X(81:120);((.1-.01*(X(1:40)+65))./(exp(1-.1*(X(1:40)+65))-1)).*(1-X(121:160))-(.125*exp(-(X(1:40)+65)/80)).*X(121:160);(.001*exp((-85-X(1:40))/30)).*(1-X(161:200))-(.0034./(exp((-17-X(1:40))/10)+1)).*X(161:200);(0.002).*(-((8.48826)*(1./max(.001,(1+exp(-(X(1:40)+20)/9)))).^2.*(X(1:40)-(150))))-(X(201:240)-(0))/(80);(((0.0056)*X(201:240)./((0.0056)*X(201:240)+(0.002)))-X(241:280))./(1./((0.0056)*X(201:240)+(0.002)));-X(281:290)./(12) + ((1-X(281:290))/(0.083)).*(1+tanh(X(621:630)/10));(((-((80).*X(331:370).^3.*X(371:410).*(X(291:330)-(55))))+((-((25).*X(411:450).*X(451:490).*(X(291:330)-(-80))))+((((400).*randn((40),1).*sqrt((0.01))))+((-((0.54).*(X(291:330)-(-80))))+((-((0.9)*(1./(1+exp(-(X(291:330)+(55.7+(5)))/7.7))).^3.*X(491:530).*(X(291:330)-(55))))+((((15)*(t>(50) & t<(200)).*Ed_item1_mask))+((((15)*(t>(50) & t<(200)).*Ed_item2_mask))+((-((2).*sum(((X(291:330)*ones(1,size(X(291:330),1)))'-(X(1:40)*ones(1,size(X(1:40),1)))).*E_Ed_iCOM_mask,2)))+((-(E_Ed_iNMDAgbar_gbar.*(1./(1+exp(-.062*X(291:330))*(1.5)/3.57)).*(X(531:570)'*(E_Ed_iNMDAgbar_mask.*E_Ed_iNMDAgbar_kernel))'.*(X(291:330)-(0))))+((-((E_Ed_iSYNgbar_gbar.*(X(571:610)'*(E_Ed_iSYNgbar_mask.*E_Ed_iSYNgbar_kernel))'.*(X(291:330)-(0)))))+((-((CB_Ed_iSYNgbar_gbar.*(X(611:620)'*(CB_Ed_iSYNgbar_mask.*CB_Ed_iSYNgbar_kernel))'.*(X(291:330)-(-80)))))+0))))))))))))./(0.8);((2.5-.1*(X(291:330)+65))./(exp(2.5-.1*(X(291:330)+65))-1)).*(1-X(331:370))-(4*exp(-(X(291:330)+65)/18)).*X(331:370);(.07*exp(-(X(291:330)+65)/20)).*(1-X(371:410))-(1./(exp(3-.1*(X(291:330)+65))+1)).*X(371:410);((1./(1+exp(-(X(291:330)+34)/6.5)))-X(411:450))./(8./(exp(-(X(291:330)+55)/30)+exp((X(291:330)+55)/30)));((1./(1+exp((X(291:330)+65)/6.6)))-X(451:490))./(100+100./(1+exp(-(X(291:330)+65)/6.8)));(.001*exp((-85-X(291:330))/30)).*(1-X(491:530))-(.0034./(exp((-17-X(291:330))/10)+1)).*X(491:530);E_Ed_iNMDAgbar_alphar*((0.001)./(1+exp(-(X(1:40)-(2))/(5)))).*(1-X(531:570))-X(531:570)/(150);-X(571:610)./(2) + ((1-X(571:610))/(0.083)).*(1+tanh(X(1:40)/10));-X(611:620)./(20) + ((1-X(611:620))/(0.083)).*(1+tanh(X(701:710)/10));(((-((0.3).*(X(621:630)-(-70))))+((-((25).*((-.1*(X(621:630)+35)./(exp(-.1*(X(621:630)+35))-1))./((-.1*(X(621:630)+35)./(exp(-.1*(X(621:630)+35))-1))+(4*exp(-(X(621:630)+60)/18)))).^3.*X(631:640).*(X(621:630)-(55))))+((-((10).*X(641:650).^4.*(X(621:630)-(-90))))+((((0).*randn((10),1).*sqrt((0.01))))+((-((E_I_iSYNgbar_gbar.*(X(651:690)'*(E_I_iSYNgbar_mask.*E_I_iSYNgbar_kernel))'.*(X(621:630)-(0)))))+((-(((0.6)/((1)*(10))).*X(691:700).*(X(621:630)-(-80))))+0)))))))./(0.8);(1)*((.07*exp(-(X(621:630)+58)/20)).*(1-X(631:640))-(1./(exp(-.1*(X(621:630)+28))+1)).*X(631:640));(1)*((-.01*(X(621:630)+34)./(exp(-.1*(X(621:630)+34))-1)).*(1-X(641:650))-(.125*exp(-(X(621:630)+44)/80)).*X(641:650));-X(651:690)./(2) + ((1-X(651:690))/(0.083)).*(1+tanh(X(1:40)/10));((1./(1+exp(-(X(621:630)-(0))/2)))./(0.083)).*(1-X(691:700))-X(691:700)/(12);(((((5)*(t>(1200) & t<(2200)).*CB_ifocal_mask))+((-((0.3).*(X(701:710)-(-70))))+((-((100).*X(711:720).^3.*X(721:730).*(X(701:710)-(55))))+((-((25).*X(731:740).^4.*(X(701:710)-(-80))))+((-((1).*X(741:750).^4.*X(751:760).*(X(701:710)-(-80))))+((-((25).*X(761:770).*(X(701:710)-(-35))))+(((0).*randn((10),1))+((-((E_CB_iSYNgbar_gbar.*(X(771:810)'*(E_CB_iSYNgbar_mask.*E_CB_iSYNgbar_kernel))'.*(X(701:710)-(0)))))+0)))))))))/(0.8);((2.5-.1*(X(701:710)+65))./(exp(2.5-.1*(X(701:710)+65))-1)).*(1-X(711:720))-(4*exp(-(X(701:710)+65)/18)).*X(711:720);(.07*exp(-(X(701:710)+65)/20)).*(1-X(721:730))-(1./(exp(3-.1*(X(701:710)+65))+1)).*X(721:730);(((3*(-.018*(X(701:710)-13)./(-1+exp(-(X(701:710)-13)/25))))./((3*(-.018*(X(701:710)-13)./(-1+exp(-(X(701:710)-13)/25))))+(.0054*(X(701:710)-23)./(-1+exp((X(701:710)-23)/12)))))-X(731:740))./(1./((3*(-.018*(X(701:710)-13)./(-1+exp(-(X(701:710)-13)/25))))+(.0054*(X(701:710)-23)./(-1+exp((X(701:710)-23)/12)))));((1./(1+exp(-(X(701:710)+60)/8.5)))-X(741:750))./(.37+1./(exp((X(701:710)+46)/5)+exp(-(X(701:710)+238)/37.5)));((1./(1+exp((X(701:710)+78)/6)))-X(751:760))./(19+1./(exp((X(701:710)+46)/5)+exp((X(701:710)+238)/(-37.5))));((1).*((1 ./ (1+exp(((-87.5)-X(701:710))/(-5.5)))) ./ (1./((1).*exp(-14.6-.086*X(701:710))+(1).*exp(-1.87+.07*X(701:710)))))).*(1-X(761:770))-((1).*((1-(1 ./ (1+exp(((-87.5)-X(701:710))/(-5.5)))))./(1./((1).*exp(-14.6-.086*X(701:710))+(1).*exp(-1.87+.07*X(701:710)))))).*X(761:770);-X(771:810)./(2) + ((1-X(771:810))/(0.083)).*(1+tanh(X(1:40)/10));];
IC = [-70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70     0.067771    0.0786987    0.0587868     0.115242       0.1195     0.110791    0.0696474     0.101661    0.0546817    0.0790219      0.10917     0.121517     0.141007    0.0904499    0.0882978     0.061651     0.108154    0.0869301     0.121817     0.128863    0.0836176    0.0913008    0.0884439     0.136952     0.129184      0.11151    0.0608861    0.0517649    0.0510757    0.0873799     0.127254     0.133447    0.0963517     0.106875     0.066055    0.0766294     0.102884    0.0996423     0.143262     0.144063     0.550808     0.588328     0.544105     0.584428     0.571764     0.625222     0.612376     0.600558     0.584936     0.552919     0.603355     0.550552     0.540879     0.592458     0.595135     0.611799     0.568942      0.54032     0.625909     0.615055     0.615682     0.601482     0.552362     0.593429     0.592857     0.634083     0.619274     0.573912     0.554179     0.630338     0.608699      0.60944     0.553138      0.61336     0.541537       0.6318     0.625999     0.542519     0.621622     0.629449     0.377786     0.427187     0.340228     0.384335     0.379854     0.398961     0.380629     0.372344     0.384318     0.412816     0.394014     0.417673     0.398922     0.417159     0.390475     0.361881     0.436406     0.361426     0.395852     0.406922     0.379384     0.371792     0.356015     0.352356     0.390045     0.355826     0.401577     0.408241     0.430302     0.347612     0.428009     0.396489     0.379348     0.361346     0.420674     0.389015     0.432531     0.428624     0.417987     0.355956     0.303904      0.75993     0.310926     0.145754     0.346241     0.192094     0.550431     0.124119     0.688578    0.0186392     0.303042     0.576536     0.660151     0.708494     0.974142     0.532622     0.120441      0.60914     0.019311     0.858445     0.717659     0.751455     0.437569     0.930776     0.375403    0.0224728      0.86244     0.855682     0.909428     0.653391      0.48327     0.224205     0.554657     0.122971     0.769918    0.0290789     0.699669     0.512333     0.420359     0.411821     0.758752    0.0768799        0.837     0.742776     0.611629     0.866287     0.187247     0.338477     0.183783     0.341465      0.10607     0.906991     0.516952     0.951331    0.0833432     0.276728     0.831654    0.0654079     0.498673     0.111638     0.560884     0.928149      0.81051     0.183249     0.460148     0.389434      0.62723     0.057257    0.0416306     0.368381     0.485666      0.91308    0.0361634      0.43993    0.0332128     0.294742     0.588566     0.465282     0.149281     0.365757     0.869252      0.75638      0.31822     0.328353     0.121626     0.251488     0.951544     0.555922     0.664035     0.922731     0.825226     0.282992     0.101659     0.731899     0.445052      0.17644     0.719092     0.239127     0.839072    0.0927241     0.709569     0.933158     0.615053     0.672302     0.658173     0.452466     0.621301    0.0238798     0.722329     0.310563     0.923181     0.649542     0.158105     0.495799     0.111291     0.521898     0.293693     0.855706      0.35228     0.278364            0            0            0            0            0            0            0            0            0            0          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70     0.142458    0.0527458     0.110483     0.055238     0.120726    0.0835132     0.122961    0.0894785    0.0733957      0.11761    0.0814188     0.109827    0.0987141     0.134187     0.146003    0.0520749     0.119221    0.0962449    0.0830855    0.0695753     0.101603     0.131537    0.0874985    0.0673144     0.107236    0.0965143    0.0578576     0.122844    0.0952105    0.0627691      0.11932     0.127271     0.135458     0.144743    0.0502275     0.075388    0.0810839    0.0566636     0.101952    0.0592489     0.550808     0.566148     0.638549     0.563779     0.591306     0.618581      0.61579      0.60162      0.58534     0.595228     0.603977     0.619713      0.62348     0.611198     0.584993     0.600079     0.598271     0.551155     0.616388     0.582301     0.603443     0.578689     0.566286     0.558855     0.565429     0.541533     0.550352     0.585464     0.543657     0.559814     0.561633     0.584137     0.557801     0.595055     0.540799     0.545811     0.554241     0.630988     0.596609     0.622554     0.656271     0.797118     0.847022     0.863587      0.85085     0.455182     0.573692     0.345493     0.491993     0.119931     0.107958     0.923037     0.299912     0.260336     0.420555     0.948581     0.684703     0.228889     0.421865     0.435543     0.983406     0.883065      0.32772     0.111962     0.330956     0.922485     0.868976      0.93256     0.106965     0.345233     0.894094     0.775008     0.874289     0.921004     0.471918     0.254231     0.678483     0.375306      0.69544     0.438142      0.26506     0.120571     0.312119     0.530579      0.39222     0.966104     0.146704    0.0122859    0.0784918     0.919967     0.566639     0.730405     0.210092    0.0369181     0.289919    0.0350354      0.17464     0.287744     0.799446     0.546413     0.802982     0.576677     0.783167     0.444132     0.844212     0.728368     0.293326     0.985287     0.313701       0.1594     0.967934     0.958853     0.606795     0.163527     0.218597     0.622427     0.901287    0.0822585     0.984884    0.0477815     0.540029     0.225449     0.606938     0.370281     0.281841     0.089359     0.950445     0.267795     0.388103     0.892352     0.169798     0.268703     0.747274     0.853066      0.46369     0.312969     0.446804     0.454007     0.856545     0.302218     0.520229     0.866086    0.0860079     0.423927     0.299841     0.394049    0.0207896     0.849318     0.424949     0.355492     0.676241     0.724691     0.614048      0.90681     0.886418      0.61995     0.140275     0.946857     0.188834     0.486639     0.176904     0.105708      0.19766     0.167425     0.107562     0.148206     0.174886     0.163122     0.184787     0.139017     0.100983     0.167886     0.163614     0.178375      0.19685     0.115743     0.183883     0.198084     0.181382     0.107869     0.133726     0.102952     0.160244     0.168259     0.168142     0.154182      0.10986     0.154985      0.18035     0.187536     0.162058     0.161361     0.177622     0.182786     0.166521      0.10471     0.124755     0.179067     0.172314     0.182343          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1            0            0            0            0            0            0            0            0            0            0          -70          -70          -70          -70          -70          -70          -70          -70          -70          -70         0.54         0.54         0.54         0.54         0.54         0.54         0.54         0.54         0.54         0.54         0.34         0.34         0.34         0.34         0.34         0.34         0.34         0.34         0.34         0.34            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0     0.194304     0.124406     0.183028      0.18062     0.124739     0.193673     0.169464      0.16308     0.100719     0.106877          -65          -65          -65          -65          -65          -65          -65          -65          -65          -65     0.098536     0.148938     0.132018    0.0919442    0.0647603     0.107399    0.0831903      0.05129    0.0974454     0.126202     0.566511     0.601816      0.60151     0.630233     0.627797     0.592899      0.57356     0.557056     0.597985     0.548969          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1          0.1     0.439435     0.231869     0.587145     0.961405     0.842063     0.538067      0.75917    0.0325651     0.838967     0.627789     0.621188     0.443782     0.310183     0.204235     0.690813     0.978825     0.857824     0.950593     0.606422     0.300221            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0];
labels = {'E\_V','E\_iNa\_mNaf','E\_iNa\_hNaf','E\_iK\_nKf','E\_iNap\_hNap','E\_CaDyn\_cai','E\_iCan\_mCan','I\_E\_iSYNgbar\_sSYNpre','Ed\_V','Ed\_iNa\_mNaf','Ed\_iNa\_hNaf','Ed\_iKs\_qKs','Ed\_iKs\_rKs','Ed\_iNap\_hNap','E\_Ed\_iNMDAgbar\_sNMDApre','E\_Ed\_iSYNgbar\_sSYNpre','CB\_Ed\_iSYNgbar\_sSYNpre','I\_V','I\_wbNa\_h','I\_wbK\_n','E\_I\_iSYNgbar\_sSYNpre','I\_I\_wbSYN\_s','CB\_V','CB\_iNa\_mNaf','CB\_iNa\_hNaf','CB\_dgKdr\_n','CB\_iA\_a','CB\_iA\_b','CB\_iAR\_mAR','E\_CB\_iSYNgbar\_sSYNpre'};
%-----------------------------------------------------------
tspan=[0 300];
for pt=[.01:-.001:.001]
  options=odeset('RelTol',pt,'AbsTol',pt); name=['RelTol=' num2str(pt)];
  try tic; [t,y]=ode45(model,tspan,IC,options); figure('name',name); plot(t,y); disp(name); title(sprintf('%g',toc)); toc; end
end
for pt=[.001:-.0001:.0001]
  options=odeset('RelTol',pt,'AbsTol',pt); name=['RelTol=' num2str(pt)];
  try tic; [t,y]=ode45(model,tspan,IC,options); figure('name',name); plot(t,y); disp(name); title(sprintf('%g',toc)); toc; end
end


%-----------------------------------------------------------
disp('setting ode options');
tspan=[0 300];
options=odeset('RelTol',.001,'AbsTol',.001); name='RelTol=.001';
% options=odeset('RelTol',.1,'AbsTol',.1); name='RelTol=.1';
try tic; [t,y]=ode23(model,tspan,IC,options); figure('name',name); plot(t,y); disp('ode23'); title(sprintf('%g',toc)); toc; end
try tic; [t,y]=ode45(model,tspan,IC,options); figure('name',name); plot(t,y); disp('ode45'); title(sprintf('%g',toc)); toc; end
try tic; [t,y]=ode113(model,tspan,IC,options); figure('name',name); plot(t,y); disp('ode113'); title(sprintf('%g',toc)); toc; end
try tic; [t,y]=ode23t(model,tspan,IC,options); figure('name',name); plot(t,y); disp('ode23t'); title(sprintf('%g',toc)); toc; end
try tic; [t,y]=ode23tb(model,tspan,IC,options); figure('name',name); plot(t,y); disp('ode23tb'); title(sprintf('%g',toc)); toc; end
% try tic; [t,y]=ode15s(model,tspan,IC,options); figure('name',name); plot(t,y); disp('ode15s'); title(sprintf('%g',toc)); toc; end
try tic; [t,y]=ode23s(model,tspan,IC,options); figure('name',name); plot(t,y); disp('ode23s'); title(sprintf('%g',toc)); toc; end

legend(labels{:});

tspan=[0 1000];
disp('using default ode options');
try tic; [t,y]=ode23(model,tspan,IC); figure; plot(t,y); disp('ode23'); toc; end
try tic; [t,y]=ode45(model,tspan,IC); figure; plot(t,y); disp('ode45'); toc; end
try tic; [t,y]=ode113(model,tspan,IC); figure; plot(t,y); disp('ode113'); toc; end
try tic; [t,y]=ode23t(model,tspan,IC); figure; plot(t,y); disp('ode23t'); toc; end
try tic; [t,y]=ode23tb(model,tspan,IC); figure; plot(t,y); disp('ode23tb'); toc; end
% try tic; [t,y]=ode15s(model,tspan,IC); figure; plot(t,y); disp('ode15s'); toc; end
try tic; [t,y]=ode23s(model,tspan,IC); figure; plot(t,y); disp('ode23s'); toc; end

%{
using default ode options with Michelle's model
ode23
Elapsed time is 370.271671 seconds.
ode45
Elapsed time is 552.783636 seconds.
ode15s failed to complete after multiple hours.
...
%}




